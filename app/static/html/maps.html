<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <title>Bootstrap Project</title>

  <!-- CSS Libs -->
  <link rel="stylesheet" href="../css/bootstrap.min.css">
  <link rel="stylesheet" href="../css/style.css">

  <!-- MAPS -->
  <link rel="stylesheet" href="../css/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
  <script src="../js/leaflet.js"></script>
  <script src="../js/leaflet-heat.js"></script>
  <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>

  <style>
    #map {
      width: 100%;
      height: 500px;
      margin-top: 30px;
      border-radius: 10px;
      margin-left: 8px;
      margin-bottom: 50px
    }
  </style>

</head>

<body>

  <nav class="navbar navbar-expand-lg navbar-dark bg-primary"
    style="margin-bottom: 30px; padding-top: 5px; padding-bottom: 5px;">
    <a class="navbar-brand" href="#">ГдеСвязи.Нет</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor01"
      aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <img src="../img/logo2.png" style="width: 70px; margin: 0px 20px; height: 50px; margin-left: 0px" alt="">

    <div class="collapse navbar-collapse" id="navbarColor01">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="nav-link" href="http://127.0.0.1:8080/">Главная</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="maps.html">Построить маршрут</span></a>
        </li>
      </ul>
    </div>
  </nav>

  <div class="container">
    <div class="row">
      <div style="margin-bottom: 20px" class="col-12">

        <p style="display: inline-block; margin-right: 10px">Операторы: </p>

        <div class="checkselect">
          <label><input type="checkbox" name="brands[]" value="1" checked>МТС</label>
          <label><input type="checkbox" name="brands[]" value="2">МегаФон</label>
          <label><input type="checkbox" name="brands[]" value="3">Билайн</label>
          <label><input type="checkbox" name="brands[]" value="4">Tele2</label>
          <label><input type="checkbox" name="brands[]" value="5">Yota</label>
          <label><input type="checkbox" name="brands[]" value="6">Ростелеком</label>
        </div>

        <p style="display: inline-block; margin-right: 10px; margin-left: 30px">Тип сети: </p>

        <div class="checkselect">
          <label><input type="checkbox" name="brands[]" value="1" checked> 2G</label>
          <label><input type="checkbox" name="brands[]" value="2"> 3G</label>
          <label><input type="checkbox" name="brands[]" value="3"> 4G</label>
          <label><input type="checkbox" name="brands[]" value="4"> 5G</label>
        </div>
      </div>

      <div class="container" style="width: 500px">
        <select id="select-city1" class="form-control form-control-xs selectpicker" name="" data-size="7"
          data-live-search="true" data-title="Location" id="state_list" data-width="100%">
        </select>
      </div>

      <img src="../img/logo1.png" alt="" style="width: 30px">


      <div class="container" style="width: 500px">
        <select id="select-city2" class="form-control form-control-xs selectpicker" name="" data-size="7"
          data-live-search="true" data-title="Location" id="state_list" data-width="100%">
        </select>
      </div>

      <button type="button" id="bildBtn" class="btn btn-primary" style="height: 37px">Построить</button>

    </div>
  </div>

  <div class="container">
    <div class="row">
      <div class="col">
        <div id="map" style="z-index: 1"></div>
        <script src="../js/jquery-3.4.1.js"></script>

      </div>
    </div>
  </div>


  <!--<div class="card-container">
    <h2 class="types">2G 3G 4G 5G</h2>
    <div class="operator-selector">
      <h4 style="display: inline-block; margin-right: 20px">Выбор оператора:</h4>
      <select class="form-control" name="" id="">
        <option value="">MTS</option>
        <option value="">Megafon</option>
        <option value="">BeeLine</option>
        <option value="">Tele2</option>
      </select>
    </div>
    <h2 class="date-block">Субботта, 28 сентября: <b>16:00 - 17:00</b></h2>
    <h2 class="power-block">Качество связи: <b>100%</b></h2>
    <h2 class="time-to-down">До падения сети: <b>2 часа</b></h2>
    <div class="blocks-container">
    <div style="margin-left: 6px" class="info-block">
      <h4 class="date-info-block">16:00</h4>
      <img class="img-power" src="../img/power4.png" alt="">
      <h4 class="power-info-block">100%</h4>
    </div>
    <div class="info-block">
      <h4 class="date-info-block">17:00</h4>
      <img class="img-power" src="../img/power2.png" alt="">
      <h4 class="power-info-block">100%</h4>
    </div>
    <div class="info-block">
      <h4 class="date-info-block">18:00</h4>
      <img class="img-power" src="../img/power1.png" alt="">
      <h4 class="power-info-block">100%</h4>
    </div>
    <div class="info-block">
      <h4 class="date-info-block">19:00</h4>
      <img class="img-power" src="../img/powerNon.png" alt="">
      <h4 class="power-info-block">100%</h4>
    </div>
    <div class="info-block">
      <h4 class="date-info-block">20:00</h4>
      <img class="img-power" src="../img/power2.png" alt="">
      <h4 class="power-info-block">100%</h4>
    </div>
    </div>
  </div> -->


  <div class="container justify-content-md-center" id="tablew">
    <div class="row">
      <div class="col-2"></div>
      <div class="col-8">
        <table class="table">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Время</th>
              <th scope="col">Качество сети</th>
              <th scope="col">Тип сети</th>
            </tr>
          </thead>
          <tbody id="time-list">

          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>

  </script>


  <!-- JS Libs -->
  <script>
    //Определяем карту, координаты центра и начальный масштаб
    var map = L.map('map').setView([55.796289, 49.108795], 12);
    L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a rel="nofollow" href="http://osm.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);



    $('#bildBtn').on('click', function () {
      if ($('#table').hasClass('invisible')) {
        $('#table').removeClass('invisible');
        $('#table').addClass('visible');
      }

      $.get({
          url: "http://127.0.0.1:8080/showall",
        })
        .done(function (data) {
          let arr = [];
          for (let i = 0; i < data.length; i++) {
            arr[i] = [data[i].location.coordinates[0], data[i].location.coordinates[1], data[i].signalStrength];
          } // Преобразование массива

          function params(power, operator) {
            return {
              color: '#',
              fillColor: '#ff0000',
              fillOpacity: 0.04 * power,
              radius: 100
            }
          } // Заполнение параметров

          for (let i = 0; i < arr.length; i++) {
            L.circle([arr[i][0], arr[i][1]], params(arr[i][2])).addTo(map);
          } // Отрисовка
        });

      $.get('http://127.0.0.1:8080/show_route_quality')
        .done(function (data) {

          console.log(data);

          let arr = [];
          for (let i = 0; i < data.length; i++) {
            arr[i] = data[i].location;
          }

          var latlang = [
            arr
          ];

          console.log(arr)

          // Creating poly line options
          var polyline = L.polyline(latlang, {
            color: 'blue'
          }).addTo(map);

          map.fitBounds(polyline.getBounds());

          let dataLocal = [{
              number: 1,
              time: '16:00 - 17:00',
              power: 1,
              type: '2G'
            },
            {
              number: 2,
              time: '17:00 - 18:00',
              power: 4,
              type: '3G'
            },
          ]

          function renderList(data) {

            timeArr = ['22:00', '22:05', '22:10', '22:15', '22:20']
            let element, imgUrl;
            let arr = [];

            for (let i = 0; i < 21; i++) {
              element = data[i];
              let time = i;
              if (time < 10) {
                time = '0' + String(time);
              }
              element.time = '22:' + time;

              if (element.signalStrength == 0) {
                imgUrl = '../img/powerNon.png';
              } else {
                imgUrl = '../img/power' + element.signalStrength + '.png';
              }

              let type = '';
              for (let i = 0; i < element.signalType.length; i++) {
                type = type + ' ' + element.signalType[i];
              }

              arr[i] = '<tr><th scope="row">' + ++element.indx + '</th>' +
                '<td>' + element.time + '</td>' +
                '<td><img src="' + imgUrl + '" style="width: 50px; height: 40px">' + element.signalStrength * 25 +
                '%</td>' +
                '<td>' + type + '</td></tr>';
            }

            for (let i = 0; i < arr.length; i++) {
              $('#time-list').append(arr[i]);
            }
          }

          renderList(data);

        })

    })
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous">
  </script>
  <script src="../js/bootstrap.js"></script>
  <script src="../js/script.js"></script>
</body>

</html>